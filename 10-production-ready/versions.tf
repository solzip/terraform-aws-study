# ==========================================
# versions.tf - Terraform 및 Provider 버전 설정
# ==========================================
#
# 이 파일의 역할:
#   프로덕션 환경에서 가장 중요한 것 중 하나는 "재현 가능성"입니다.
#   모든 팀원이 동일한 버전의 Terraform과 Provider를 사용해야
#   예측 가능한 결과를 얻을 수 있습니다.
#
# 프로덕션 핵심 원칙:
#   1. 버전을 명시적으로 고정 (암묵적 업그레이드 방지)
#   2. required_version으로 Terraform 버전 강제
#   3. Provider 버전 범위를 적절히 제한

# ==========================================
# Terraform 설정
# ==========================================
terraform {
  # ------------------------------------------
  # Terraform 최소 버전 요구사항
  # ------------------------------------------
  # >= 1.0: Terraform 1.0 이상 필수
  # 1.0은 HashiCorp가 "안정 버전"으로 선언한 첫 버전입니다.
  # 프로덕션에서는 팀 전체가 같은 버전을 사용하는 것을 권장합니다.
  required_version = ">= 1.0"

  # ------------------------------------------
  # 필요한 Provider 목록
  # ------------------------------------------
  required_providers {
    # AWS Provider
    # ~> 5.0: 5.x 범위 내에서만 업데이트 허용
    # 예: 5.0 → 5.99 OK, 6.0 NG (Major 변경 차단)
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# ==========================================
# AWS Provider 설정
# ==========================================
# 프로덕션에서는 Provider 설정을 환경별로 분리합니다.
# 이 파일에서는 공통 설정만 정의하고,
# 환경별 설정(region 등)은 각 환경의 backend.tf에서 override합니다.
#
# default_tags: 모든 리소스에 자동으로 붙는 태그
# 태그 표준화는 프로덕션에서 비용 추적, 리소스 관리의 핵심입니다.
provider "aws" {
  region = var.aws_region

  # ------------------------------------------
  # 기본 태그 (모든 리소스에 자동 적용)
  # ------------------------------------------
  # 프로덕션에서 태그가 중요한 이유:
  #   1. 비용 추적: 어떤 프로젝트/환경이 비용을 발생시키는지
  #   2. 리소스 관리: 누가 만들었고 어떤 용도인지
  #   3. 자동화: 태그 기반으로 백업, 모니터링 정책 적용
  #   4. 보안: ABAC(Attribute-Based Access Control) 정책
  default_tags {
    tags = {
      Project     = var.project_name
      Environment = var.environment
      ManagedBy   = "Terraform"
      Repository  = "terraform-aws-study"
    }
  }
}
